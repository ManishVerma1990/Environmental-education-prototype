<% layout('layout') -%>
<% const r = currentIndex || 0; %>
<h3 class="mb-2"><%= lesson.title %></h3>
<p class="text-muted"><%= lesson.description %></p>


<% if (current) { %>
<% if (current.type === 'video') { %>
<div class="ratio ratio-16x9 mb-3">
<iframe src="<%= current.url %>" allowfullscreen></iframe>
</div>
<% } else if (current.type === 'pdf') { %>
<div class="ratio ratio-16x9 mb-3">
<iframe src="/pdfjs/web/viewer.html?file=<%= encodeURIComponent(pdfUrlFromCloudinary) %>"></iframe>
</div>
<% } else if (current.type === 'imageSet') { %>
<div id="imgSet" class="d-flex gap-2 flex-wrap mb-3">
<% (current.images||[]).forEach(src => { %>
<img src="<%= src %>" class="img-thumbnail" style="max-width:220px"/>
<% }) %>
</div>
<% } %>
<% } %>


<div class="d-flex justify-content-between">
<a class="btn btn-outline-secondary <%= r<=0?'disabled':'' %>" href="?r=<%= Math.max(0,r-1) %>">Prev</a>
<a class="btn btn-outline-primary <%= r>=resources.length-1?'disabled':'' %>" href="?r=<%= Math.min(resources.length-1,r+1) %>">Next</a>
</div>


<form class="mt-3" action="/lessons/<%= lesson.id %>/complete" method="post">
<button class="btn btn-success" <%= r<resources.length-1?'disabled':'' %>>Mark Lesson Complete (+5)</button>
</form>


<hr/>
<h5>Checkpoints</h5>
<ul class="mb-0">
<% (checkpoints||[]).forEach(cp=>{ %>
<li>Quiz #<%= cp.quizId %> after resource <%= cp.afterResourceIndex %> â€” <a href="/quizzes/<%= cp.quizId %>/take">Take now</a></li>
<% }) %>
</ul>